@using PagedList.Mvc
@using Microsoft.SqlServer.Types;

@model PagedList.IPagedList<CRME.Models.cat_indicadores>
@{
    CRME.Models.SIRE_Context db = new CRME.Models.SIRE_Context();
    string strorden = ""; string iconorder = "";
    CRME.Models.cat_indicadores ci = new CRME.Models.cat_indicadores();
    var year = DateTime.Now.Year;
}


<div class="row margin-10">
    <div class="col l6 m6 s11 titlecircle">
        <b>Indicadores Registrados</b>
    </div>
    <div class="col l6 m6 s1 separator">
    </div>
</div>
@if (Auth.Usuario.perfil_ID == 6)
{
    <div class="row">
        <div class="col s12 m4 l4 input-field">
            <a class="btn light-blue darken-4 waves-effect nuevores white-text" href="@Url.Action("VisualizarInd","IndicadoresView")"><i class="mdi mdi-plus"></i> Asignar Indicador</a>
        </div>
    </div>
}

<div id="TablaIndicadores">

    <div class="row">
        <div class="col l12 m12 s12">
            <table class="striped highlight light-blue">
                <thead class="table-header-blue">
                    <tr class="table-header-tr-blue">
                        @if (Auth.Usuario.perfil_ID == 6 || Auth.Usuario.perfil_ID == 1)
                        {
                            <td colspan="22" class="center-align">INDICADORES @DateTime.Now.Year    </td>
                        }
                        else
                        {
                            <td colspan="21" class="center-align">INDICADORES @DateTime.Now.Year    </td>
                        }

                    </tr>
                    <tr class="table-header-tr-blue">
                        <td class="center">Empresa</td>
                        <td class="center hide-on-small-only">Proceso</td>
                        <td class="center hide-on-small-only">Indicador</td>
                        <td class="center hide-on-small-only">Calculo</td>
                        <td class="center hide-on-small-only">Res Esperado</td>
                        <td class="center hide-on-small-only">Resp medicion</td>
                        <td class="center hide-on-small-only">Frec medicion</td>
                        <td class="center hide-on-small-only">Resp mejora</td>
                        <td class="center hide-on-small-only">Ene</td>
                        <td class="center hide-on-small-only">Feb</td>
                        <td class="center hide-on-small-only">Mar</td>
                        <td class="center hide-on-small-only">Abr</td>
                        <td class="center hide-on-small-only">May</td>
                        <td class="center hide-on-small-only">Jun</td>
                        <td class="center hide-on-small-only">Jul</td>
                        <td class="center hide-on-small-only">Ago</td>
                        <td class="center hide-on-small-only">Sep</td>
                        <td class="center hide-on-small-only">Oct</td>
                        <td class="center hide-on-small-only">Nov</td>
                        <td class="center hide-on-small-only">Dic</td>

                        @*<td class="center hide-on-small-only">Avance</td>*@
                        @if (Auth.Usuario.perfil_ID == 6 || Auth.Usuario.perfil_ID == 1)
                        {
                            <td class="center hide-on-small-only">Grafica</td>
                            foreach (var its in Model)
                            {
                                if (its.por_cum != 100)
                                {
                                    <td class="center">Opciones</td>
                                    break;
                                }
                                else
                                {
                                    break;
                                }
                            }

                        }
                        else if (Auth.Usuario.perfil_ID != 6 || Auth.Usuario.perfil_ID != 1)
                        {
                            <td class="center">Opciones</td>
                        }


                    </tr>
                </thead>
                <tbody class="table-body-blue">
                    @if (Model.Count == 0)
                    {
                        <tr class="table-body">
                            <td colspan="22" class="center">
                                <b>No se encontraron coincidencias</b>
                            </td>
                        </tr>
                    }
                    else
                    {
                        foreach (var item in Model)
                        {

                <tr class="table-body">


                    @if (item.year == year)
                    {
                        <td class="center hide-on-small-only" style="display:none;">@Html.DisplayFor(modelItem => item.indicadores_ID)</td>
                        <td class="left-align" style="text-transform: uppercase;">@Html.DisplayFor(modelItem => db.Empresa.Find(db.Procesos.Find(item.proceso).Em_Cve_Empresa).Em_Descripcion)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => db.Procesos.Find(item.proceso).descripcion)</td>
                        @*Nombre del proceso*@
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.indicador)</td>
                        @*Nombre del Indicador*@
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.form_cal)</td>
                        @*Formula del Calcula*@
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.res_esp) %</td>
                        @*Resultado Esperado*@

                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => db.Procesos.Find(item.proceso).responsable)</td>
                        @*Nombre del responsable de Medicion*@

                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => db.cat_periodos.Find(item.frec_med).periodo_des)</td>
                        @*Frecuencia de la Medicion*@

                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => db.Puestos.Find(item.resp_mej).Pu_Descripcion)</td>
                        @*Responsable de Mejora*@



                        @*INICIO DE DELIVERACION POR PERIODOS*@
                        @*INICIO PORCENTAJES MENSUAL Y ANUAL*@
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.ene)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.feb)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.mar)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.abr)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.may)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.jun)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.jul)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.ago)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.sep)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.oct)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.nov)</td>
                        <td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.dec)</td>
                        @*<td class="center hide-on-small-only" style="">@Html.DisplayFor(modelItem => item.por_cum) %</td>*@
                        @*FIN PORCENTAJES MENSUAL Y ANUAL*@
                        @*FIN DE DELIVERACION POR PERIODOS*@

                        if (Auth.Usuario.perfil_ID == 6 || Auth.Usuario.perfil_ID == 1)
                        {
                            <td class="center hide-on-small-only" style="">
                                <a href="@Url.Action("GenerarReporte", "IndicadoresView", new {idIndicador=item.indicadores_ID})" class="GenerarReporte" data-position="bottom" data-delay="50" title="Grafica" style="cursor:pointer;"><i class="mdi mdi-chart-bar mdi-24px black-text"></i></a>
                            </td>
                        }


                        if (Auth.Usuario.perfil_ID == 6 || Auth.Usuario.perfil_ID == 1)
                        {
                            if (item.por_cum == 100)
                            {
                                <td class="center">
                                    <a href="#ancla" class="agregadatos" data-position="bottom" data-delay="50" title="Agregar Datos" data-tooltip="Agregar datos" style="cursor:pointer;" id-item="@item.indicadores_ID" id-vend=""><i class="mdi mdi-plus-box-multiple mdi-24px green-text"></i></a>&nbsp; &nbsp;
                                </td>
                            }
                            else if (item.por_cum != 100)
                            {
                                <td class="center">
                                    <a href="#ancla" class="agregadatos" data-position="bottom" data-delay="50" title="Agregar Datos" data-tooltip="Agregar datos" style="cursor:pointer;" id-item="@item.indicadores_ID" id-vend=""><i class="mdi mdi-plus-box-multiple mdi-24px orange-text"></i></a>&nbsp; &nbsp;
                                </td>
                            }
                            else if (item.por_cum == 100)
                            {
                                <td class="center">
                                    <a href="#ancla" class="agregadatos" data-position="bottom" data-delay="50" title="Agregar Datos" data-tooltip="Agregar datos" style="cursor:pointer;" id-item="@item.indicadores_ID" id-vend=""><i class="mdi mdi-plus-box-multiple mdi-24px red-text"></i></a>&nbsp; &nbsp;
                                </td>
                            }

                        }
                        else
                        {
                            if (item.por_cum == 100)
                            {
                                <td class="center">
                                    <i class="mdi mdi-plus-box-multiple mdi-24px green-text"></i>&nbsp; &nbsp;
                                </td>
                            }
                            else if (item.por_cum != 100)
                            {
                                <td class="center">
                                    <a href="#ancla" class="agregadatos" data-position="bottom" data-delay="50" title="Agregar Datos" data-tooltip="Agregar datos" style="cursor:pointer;" id-item="@item.indicadores_ID" id-vend=""><i class="mdi mdi-plus-box-multiple mdi-24px orange-text"></i></a>&nbsp; &nbsp;
                                </td>
                            }
                            else if (item.por_cum == 100)
                            {
                                <td class="center">
                                    <a href="#ancla" class="agregadatos" data-position="bottom" data-delay="50" title="Agregar Datos" data-tooltip="Agregar datos" style="cursor:pointer;" id-item="@item.indicadores_ID" id-vend=""><i class="mdi mdi-plus-box-multiple mdi-24px red-text"></i></a>&nbsp; &nbsp;
                                </td>
                            }
                        }
                    }
                    else
                    {
                        <tr class="table-body">
                            <td colspan="22" class="center">
                                <b>No se encontraron coincidencias</b>
                            </td>
                        </tr>
                    }
                </tr>
                        }
                    }
                </tbody>
            </table>
        </div>
    </div>

    <div class="row">
        <div class="col s12 center-align">
            @if (Model != null)
            {
                @Html.PagedListPager(Model, page => Url.Action("_TablaLineas", new { page })
                    , PagedListRenderOptions.EnableUnobtrusiveAjaxReplacing(new PagedListRenderOptions()
                    {
                        Display = PagedListDisplayMode.IfNeeded,
                        DisplayPageCountAndCurrentLocation = true,
                        DisplayItemSliceAndTotal = false,
                        PageCountAndCurrentLocationFormat = "Página {0} de {1}.",
                        ItemSliceAndTotalFormat = "Mostrando los elementos {0} a {1} de {2}.",
                        LinkToIndividualPageFormat = "{0}",
                    }, new AjaxOptions()
                    {
                        HttpMethod = "POST",
                        UpdateTargetId = "TablaIndicadores",
                        OnComplete = "FltOnCompletePer",
                        OnBegin = "FltOnBeginPer"
                    }
                )
            )
            }
        </div>
    </div>
</div>
 