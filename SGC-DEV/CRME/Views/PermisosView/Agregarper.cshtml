@using CustomHelpers
@{
    ViewBag.Title = "Agregar Permisos";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<!-- Tab Structure -->
<a name="ancla" id="ancla"></a>
<div class="row form-general margin-top-30 padding-20">
    <div class="col s12">
        <div class="row">
            <div class="col s12 margin-top-25">
                <div id="New_UpdatePersona">
                    @Html.Action("_FormularioPermisos", "PermisosView")
                </div>
            </div>
        </div>
        @*  *@
    </div>
</div>
<div id="ModalAlert" class="modal modal-fixed-footer" style="width:300px; height:240px;">
    <div class="md-header center"><img src="~/Upload/Sistema/Logo_CA.png" style="width:40px" /></div>
    <div class="modal-content md-content">
        <h5 class="md-title">Título</h5>
        <span><i class="md-icono mdi mdi-36px"></i><span><span class="md-message">Mensaje</span></span></span>
    </div>
    <div class="modal-footer">
        <a href="javascript:void(0)" class="modal-action modal-close waves-effect waves-red btn-flat md-btn-danger hide md-cancel cancelar-eventos">Cancelar</a>
        <a href="javascript:void(0)" class="modal-action waves-effect waves-green btn-flat md-btn-success md-accept">Aceptar</a>
    </div>
</div>
@section scripts{
    <script type="text/javascript">
        $(document).ready(function () {
            $("#ModalAlert").modal();

            $(".cancelar-eventos").off('click');
            $(".cancelar-eventos").on('click', function (e) {
                $('#ModalAlert').off("click", ".md-accept");
            });
        });

        guardarIndicador();
        function guardarIndicador() {

            $("#FrmPermiso").off('click', '.guardarPermiso');
            $("#FrmPermiso").on("click", ".guardarPermiso", function (e) {
                //alert(" ");
                e.preventDefault();
                $(".guardarPermiso").attr("disabled", true);
                /*CargarReglasGeneralFormuario();*/
                if ($("#FrmPermiso").valid()) {
                    var frmValues = $("#FrmPermiso").serialize();
                    $.ajax({
                        url: '@Url.Action("SavePermisos", "PermisosView")',
                        data: frmValues,
                        type: "POST",
                        success: function (result) {//obtiene el resultado json
                            $(".guardarPermiso").attr("disabled", false);
                            if (result.success) {//si es true el resultado
                                $('#mensaje-error-model').text("");
                                $("#New_UpdateIndicador").load('@Url.Action("_FormularioPermisos", "PermisosView")', function (response, status, xhr) {
                                    if (status == "success") {
                                        guardarIndicador();
                                    }
                                });
                                ConfigModal($('#ModalAlert'), "", "Operación realizada con éxito.", 1)//para crear la ventana flotante
                                $("#ModalAlert").modal({
                                    dismissible: false,
                                });
                                $("#ModalAlert").modal('open');
                                window.location = "/PermisosView/index";
                                @*$("#TablaIndicadores").load('@Url.Action("_TablaLineas", "ProveedoresView")', function (response, status, xhr) {
                                    if (status == "success") {
                                    }
                                });*@
                            }
                            else if (result.mensajefound != "") {
                                ConfigModal($('#ModalAlert'), "",result.mensajefound , 3)//para crear la ventana flotante
                                $("#ModalAlert").modal({
                                    dismissible: false,
                                });
                                $("#ModalAlert").modal('open');
                            }
                        }
                    });
                } else {
                    $(".guardarPermiso").attr("disabled", false);
                }
            });
        }

        //function CargarReglasGeneralFormuario() {
        //    var formulario = $("#FrmUsuario").removeData("validator").removeData("unobtrusiveValidation");
        //    $.validator.unobtrusive.parse(formulario);

        //    jQuery.extend(jQuery.validator.messages, {
        //        minlength: jQuery.validator.format("El campo nombre debe llevar minimo {0} caracteres."),
        //        maxlength: jQuery.validator.format("Porfavor ingrese caracteres no mayores a {0}.")
        //    });

        //}
        //====================== PAGINACIONES ===========================
        //paginación personas

        function FltOnBeginPer(obj) {
            $("#TablaEmpresas #contentTablaEmpresas").addClass("loading-background");
            var $oncomplete = $('.loading-personas').addClass("loading-show").removeClass("loading");
        }

        function FltOnCompletePer(obj) {
            $("#TablaEmpresas #contentTablaEmpresas").removeClass("loading-background");
            var $oncomplete = $('.loading-personas').addClass("loading").removeClass("loading-show");
        }




    </script>
}

